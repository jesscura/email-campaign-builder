(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[461],{905:function(e,a,t){Promise.resolve().then(t.bind(t,8153))},8153:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return w}});var s=t(9566),l=t(8590),r=t(8205);function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,a="abcdefghijklmnopqrstuvwxyz0123456789",t="";for(let s=0;s<e;s++)t+=a[Math.floor(Math.random()*a.length)];return t}let i=()=>({subject:"Hello {{Leads.First_Name}}, big news inside!",preheader:"Get 20% off your next purchase. Ends soon.",fromName:"Your Brand",fromEmail:"newsletter@example.com",theme:{primaryColor:"#111827",backgroundColor:"#ffffff",textColor:"#111827"},blocks:[{id:n(),type:"image",data:{src:"https://via.placeholder.com/1200x400",alt:"Hero"}},{id:n(),type:"text",data:{html:"<h2>Welcome {{Leads.First_Name}}</h2><p>Thanks for being with us.</p>"}},{id:n(),type:"button",data:{label:"Shop now",href:"https://example.com?utm_source=newsletter"}},{id:n(),type:"divider",data:{}},{id:n(),type:"two_column",data:{leftHtml:"<p>Left content</p>",rightHtml:"<p>Right content</p>"}},{id:n(),type:"social",data:{links:[{platform:"Twitter",url:"https://twitter.com/your"},{platform:"LinkedIn",url:"https://linkedin.com/company/your"}]}}],abTest:{variantA:{subject:"Hello {{Leads.First_Name}} â€” big news!"},variantB:{subject:"Big news for you, {{Leads.First_Name}}"}}}),d=(0,r.Ue)((e,a)=>({campaign:i(),selectedBlockId:null,setCampaign:a=>e(e=>({campaign:{...e.campaign,...a}})),setTheme:a=>e(e=>({campaign:{...e.campaign,theme:{...e.campaign.theme,...a}}})),addBlock:a=>e(e=>{let t=(()=>{switch(a){case"text":return{id:n(),type:a,data:{html:"<p>Edit me...</p>"}};case"image":return{id:n(),type:a,data:{src:"",alt:""}};case"button":return{id:n(),type:a,data:{label:"Call to Action",href:"#"}};case"divider":return{id:n(),type:a,data:{}};case"spacer":return{id:n(),type:a,data:{height:16}};case"two_column":return{id:n(),type:a,data:{leftHtml:"<p>Left</p>",rightHtml:"<p>Right</p>"}};case"social":return{id:n(),type:a,data:{links:[]}}}})();return{campaign:{...e.campaign,blocks:[...e.campaign.blocks,t]}}}),removeBlock:a=>e(e=>({campaign:{...e.campaign,blocks:e.campaign.blocks.filter(e=>e.id!==a)}})),moveBlock:(a,t)=>e(e=>{let s=[...e.campaign.blocks],[l]=s.splice(a,1);return s.splice(t,0,l),{campaign:{...e.campaign,blocks:s}}}),selectBlock:a=>e({selectedBlockId:a}),updateBlock:(a,t)=>e(e=>({campaign:{...e.campaign,blocks:e.campaign.blocks.map(e=>e.id===a?{...e,...t,data:{...e.data,...t.data}}:e)}})),insertToken:e=>{let t=a().selectedBlockId;if(!t)return;let s=a().campaign.blocks.find(e=>e.id===t);if(!s||"text"!==s.type)return;let l=s.data.html||"";a().updateBlock(t,{data:{html:l+e}})},setAB:(a,t)=>e(e=>{let s={...e.campaign.abTest};return"A"===a?s.variantA={...s.variantA,...t}:s.variantB={...s.variantB,...t},{campaign:{...e.campaign,abTest:s}}})}));function c(){let[e,a]=(0,l.useState)([]),[t,r]=(0,l.useState)([]),[n,i]=(0,l.useState)("Leads"),c=d(e=>e.insertToken);return(0,l.useEffect)(()=>{fetch("/api/zoho/modules").then(e=>e.json()).then(e=>a(e.modules||[]))},[]),(0,l.useEffect)(()=>{n&&fetch("/api/zoho/fields?module=".concat(encodeURIComponent(n))).then(e=>e.json()).then(e=>r(e.fields||[]))},[n]),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("select",{className:"w-full rounded border p-2",value:n,onChange:e=>i(e.target.value),children:e.map(e=>(0,s.jsx)("option",{value:e.api_name,children:e.module_name||e.api_name},e.api_name))}),(0,s.jsx)("div",{className:"max-h-48 overflow-auto rounded border",children:t.map(e=>(0,s.jsxs)("button",{onClick:()=>{c("{{".concat(n,".").concat(e.api_name,"}}"))},className:"flex w-full items-center justify-between border-b px-3 py-1 text-left text-sm hover:bg-neutral-50",children:[(0,s.jsx)("span",{children:e.field_label}),(0,s.jsx)("span",{className:"text-xs text-neutral-500",children:e.api_name})]},e.api_name))}),(0,s.jsx)("p",{className:"text-xs text-neutral-500",children:"Click a field to insert a merge tag into the selected text block."})]})}function o(){let e=d(e=>e.campaign.theme),a=d(e=>e.setTheme),t=d(e=>e.addBlock);return(0,s.jsxs)("div",{className:"space-y-4 p-3",children:[(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"mb-2 font-semibold",children:"Blocks"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:[{type:"text",label:"Text"},{type:"image",label:"Image"},{type:"button",label:"Button"},{type:"divider",label:"Divider"},{type:"spacer",label:"Spacer"},{type:"two_column",label:"Two Column"},{type:"social",label:"Social Links"}].map(e=>(0,s.jsx)("button",{onClick:()=>t(e.type),className:"rounded border px-2 py-1 text-sm hover:bg-neutral-50",children:e.label},e.type))})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"mb-2 font-semibold",children:"Theme"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"block text-sm",children:["Primary Color",(0,s.jsx)("input",{type:"color",className:"ml-2 h-8 w-12",value:e.primaryColor,onChange:e=>a({primaryColor:e.target.value})})]}),(0,s.jsxs)("label",{className:"block text-sm",children:["Background",(0,s.jsx)("input",{type:"color",className:"ml-2 h-8 w-12",value:e.backgroundColor,onChange:e=>a({backgroundColor:e.target.value})})]}),(0,s.jsxs)("label",{className:"block text-sm",children:["Text Color",(0,s.jsx)("input",{type:"color",className:"ml-2 h-8 w-12",value:e.textColor,onChange:e=>a({textColor:e.target.value})})]})]})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"mb-2 font-semibold",children:"Personalization"}),(0,s.jsx)(c,{})]})]})}var m=t(6561),u=t(4263),p=t(450);function h(e){let{block:a}=e,t=d(e=>e.campaign.theme);switch(a.type){case"text":return(0,s.jsx)("div",{style:{color:t.textColor},dangerouslySetInnerHTML:{__html:a.data.html||"<p>Edit text...</p>"}});case"image":return(0,s.jsx)("img",{src:a.data.src||"https://via.placeholder.com/600x200",alt:a.data.alt||"",className:"h-auto w-full rounded"});case"button":return(0,s.jsx)("a",{href:a.data.href||"#",className:"inline-block rounded px-4 py-2 text-white",style:{background:t.primaryColor},children:a.data.label||"Call to Action"});case"divider":return(0,s.jsx)("hr",{className:"my-2 border-neutral-200"});case"spacer":return(0,s.jsx)("div",{style:{height:"".concat(a.data.height||16,"px")}});case"two_column":return(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:a.data.leftHtml||"<p>Left...</p>"}}),(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:a.data.rightHtml||"<p>Right...</p>"}})]});case"social":return(0,s.jsx)("div",{className:"flex gap-3",children:(a.data.links||[]).map(e=>(0,s.jsx)("a",{href:e.url,className:"text-sm underline",children:e.platform},e.platform))});default:return(0,s.jsx)("div",{children:"Unsupported block"})}}function x(){let e=d(e=>e.selectedBlockId),a=d(a=>a.campaign.blocks.find(a=>a.id===e)),t=d(e=>e.updateBlock),r=(0,l.useMemo)(()=>{if(!a)return()=>(0,s.jsx)("div",{className:"text-sm text-neutral-600",children:"Select a block to edit"});switch(a.type){case"text":return()=>(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm",children:"HTML"}),(0,s.jsx)("textarea",{className:"h-80 w-full rounded border p-2 font-mono",value:a.data.html||"",onChange:e=>t(a.id,{data:{...a.data,html:e.target.value}})})]});case"image":return()=>(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm",children:"Image URL"}),(0,s.jsx)("input",{className:"w-full rounded border p-2",value:a.data.src||"",onChange:e=>t(a.id,{data:{...a.data,src:e.target.value}})}),(0,s.jsx)("label",{className:"block text-sm",children:"Alt Text"}),(0,s.jsx)("input",{className:"w-full rounded border p-2",value:a.data.alt||"",onChange:e=>t(a.id,{data:{...a.data,alt:e.target.value}})})]});case"button":return()=>(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm",children:"Label"}),(0,s.jsx)("input",{className:"w-full rounded border p-2",value:a.data.label||"",onChange:e=>t(a.id,{data:{...a.data,label:e.target.value}})}),(0,s.jsx)("label",{className:"block text-sm",children:"URL"}),(0,s.jsx)("input",{className:"w-full rounded border p-2",value:a.data.href||"",onChange:e=>t(a.id,{data:{...a.data,href:e.target.value}})})]});case"two_column":return()=>(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm",children:"Left HTML"}),(0,s.jsx)("textarea",{className:"h-40 w-full rounded border p-2 font-mono",value:a.data.leftHtml||"",onChange:e=>t(a.id,{data:{...a.data,leftHtml:e.target.value}})}),(0,s.jsx)("label",{className:"block text-sm",children:"Right HTML"}),(0,s.jsx)("textarea",{className:"h-40 w-full rounded border p-2 font-mono",value:a.data.rightHtml||"",onChange:e=>t(a.id,{data:{...a.data,rightHtml:e.target.value}})})]});case"social":return()=>(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("button",{className:"rounded border px-2 py-1 text-sm",onClick:()=>t(a.id,{data:{...a.data,links:[...a.data.links||[],{platform:"Twitter",url:"https://twitter.com/your"}]}}),children:"Add Link"}),(0,s.jsx)("div",{className:"space-y-2",children:(a.data.links||[]).map((e,l)=>(0,s.jsxs)("div",{className:"rounded border p-2",children:[(0,s.jsx)("input",{className:"mr-2 rounded border p-1",value:e.platform,onChange:s=>{let r=[...a.data.links];r[l]={...e,platform:s.target.value},t(a.id,{data:{...a.data,links:r}})}}),(0,s.jsx)("input",{className:"ml-2 w-48 rounded border p-1",value:e.url,onChange:s=>{let r=[...a.data.links];r[l]={...e,url:s.target.value},t(a.id,{data:{...a.data,links:r}})}})]},l))})]});case"spacer":return()=>(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm",children:"Height (px)"}),(0,s.jsx)("input",{type:"number",className:"w-full rounded border p-2",value:a.data.height||16,onChange:e=>t(a.id,{data:{...a.data,height:Number(e.target.value)}})})]});default:return()=>(0,s.jsx)("div",{children:"Editor not implemented"})}},[a,t]);return(0,s.jsxs)("div",{className:"rounded border bg-white p-3",children:[(0,s.jsx)("h3",{className:"mb-2 font-semibold",children:"Block Editor"}),(0,s.jsx)(r,{})]})}function b(e){let{block:a}=e,{attributes:t,listeners:l,setNodeRef:r,transform:n,transition:i,isDragging:c}=(0,u.nB)({id:a.id}),o=d(e=>e.removeBlock),m=d(e=>e.selectBlock),b=d(e=>e.selectedBlockId),g={transform:p.ux.Transform.toString(n),transition:i,opacity:c?.5:1},j=b===a.id;return(0,s.jsxs)("div",{ref:r,style:g,className:"rounded border bg-white p-2 ".concat(j?"ring-2 ring-blue-500":""),children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center justify-between text-xs text-neutral-500",children:[(0,s.jsx)("div",{...t,...l,className:"cursor-grab select-none",children:"Drag"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>m(a.id),className:"rounded border px-2 py-0.5",children:"Edit"}),(0,s.jsx)("button",{onClick:()=>o(a.id),className:"rounded border px-2 py-0.5",children:"Delete"})]})]}),(0,s.jsx)(h,{block:a}),j&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(x,{})})]})}function g(){let e=d(e=>e.campaign.blocks),a=d(e=>e.moveBlock),t=(0,m.Dy)((0,m.VT)(m.we,{activationConstraint:{distance:5}}));return(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-[1fr_360px]",children:[(0,s.jsx)("div",{children:(0,s.jsx)(m.LB,{sensors:t,collisionDetection:m.pE,onDragEnd:function(t){let{active:s,over:l}=t;l&&s.id!==l.id&&a(e.findIndex(e=>e.id===s.id),e.findIndex(e=>e.id===l.id))},children:(0,s.jsx)(u.Fo,{items:e.map(e=>e.id),strategy:u.U2,children:(0,s.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,s.jsx)(b,{block:e},e.id))})})})}),(0,s.jsx)("div",{})]})}function j(){let e=d(e=>e.campaign),[a,t]=(0,l.useState)("");return(0,l.useEffect)(()=>{(async()=>{let a=await fetch("/api/render",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaign:e})});if(a.ok){let{html:e}=await a.json();t(e)}})()},[e]),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"mb-2 font-semibold",children:"Preview"}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("div",{className:"h-[480px] w-[320px] overflow-auto rounded border shadow-inner",children:(0,s.jsx)("iframe",{title:"mobile",className:"h-full w-full",srcDoc:a})}),(0,s.jsx)("div",{className:"h-[480px] flex-1 overflow-auto rounded border shadow-inner",children:(0,s.jsx)("iframe",{title:"desktop",className:"h-full w-full",srcDoc:a})})]})]})}function f(){let e=d(e=>e.campaign),[a,t]=(0,l.useState)([]);return(0,l.useEffect)(()=>{(async()=>{let a=await fetch("/api/preflight",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaign:e})});t((await a.json()).checks||[])})()},[e]),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"mb-2 font-semibold",children:"Preflight"}),(0,s.jsx)("ul",{className:"space-y-1",children:a.map(e=>(0,s.jsxs)("li",{className:"rounded border px-2 py-1 text-sm ".concat(e.ok?"border-green-200 bg-green-50 text-green-800":"border-amber-200 bg-amber-50 text-amber-800"),children:[(0,s.jsxs)("span",{className:"font-medium",children:[e.title,": "]}),e.message]},e.id))})]})}function v(){let e=d(e=>e.campaign.subject),a=d(e=>e.campaign.preheader),t=d(e=>e.setCampaign),r=(0,l.useMemo)(()=>{let a=100;return e.length<4&&(a-=20),e.length>60&&(a-=20),/[A-Z]/.test(e)||(a-=5),/\{\{.+\}\}/.test(e)||(a-=5),/(free|winner|guarantee|urgent|act now)/i.test(e)&&(a-=10),/!{2,}/.test(e)&&(a-=5),/(re:|fwd:)/i.test(e)&&(a-=10),Math.max(0,a)},[e]),n=(0,l.useMemo)(()=>{let t=[];return/\{\{.+\}\}/.test(e)||t.push("Add personalization, e.g., {{Leads.First_Name}}"),e.length>42&&t.push("Aim for 32â€“42 characters for mobile"),/[0-9]/.test(e)||t.push("Numbers can increase CTR (e.g., 3 tips...)"),/[?!]/.test(e)||t.push("Use a question or curiosity gap (avoid clickbait)"),a||t.push("Add a compelling preheader (35â€“50 chars)"),t},[e,a]);return(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"mb-2 font-semibold",children:"Subject & Preheader"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("input",{className:"w-full rounded border p-2",placeholder:"Subject",value:e,onChange:e=>t({subject:e.target.value})}),(0,s.jsx)("input",{className:"w-full rounded border p-2",placeholder:"Preheader",value:a,onChange:e=>t({preheader:e.target.value})}),(0,s.jsxs)("div",{className:"text-sm",children:["Score: ",(0,s.jsxs)("span",{className:r>70?"text-green-700":"text-amber-700",children:[r,"/100"]})]}),(0,s.jsx)("ul",{className:"list-inside list-disc text-sm text-neutral-700",children:n.map((e,a)=>(0,s.jsx)("li",{children:e},a))})]})]})}function N(){let e=d(e=>e.campaign.abTest.variantA),a=d(e=>e.campaign.abTest.variantB),t=d(e=>e.setAB);return(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"mb-2 font-semibold",children:"A/B Testing"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"rounded border p-2",children:[(0,s.jsx)("h4",{className:"mb-2 font-medium",children:"Variant A"}),(0,s.jsx)("label",{className:"block text-sm",children:"Subject"}),(0,s.jsx)("input",{className:"mb-2 w-full rounded border p-2",value:e.subject,onChange:e=>t("A",{subject:e.target.value})}),(0,s.jsx)("label",{className:"block text-sm",children:"Body note (optional)"}),(0,s.jsx)("input",{className:"w-full rounded border p-2",value:e.note||"",onChange:e=>t("A",{note:e.target.value})})]}),(0,s.jsxs)("div",{className:"rounded border p-2",children:[(0,s.jsx)("h4",{className:"mb-2 font-medium",children:"Variant B"}),(0,s.jsx)("label",{className:"block text-sm",children:"Subject"}),(0,s.jsx)("input",{className:"mb-2 w-full rounded border p-2",value:a.subject,onChange:e=>t("B",{subject:e.target.value})}),(0,s.jsx)("label",{className:"block text-sm",children:"Body note (optional)"}),(0,s.jsx)("input",{className:"w-full rounded border p-2",value:a.note||"",onChange:e=>t("B",{note:e.target.value})})]})]}),(0,s.jsx)("p",{className:"mt-2 text-xs text-neutral-600",children:"Export will include both variants."})]})}var y=t(976),k=t(4018);function w(){let e=d(e=>e.campaign),a=d(e=>e.setCampaign),[t]=(0,k.Nr)(e,500);async function r(){let a=await fetch("/api/render",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaign:e})});if(!a.ok)return y.A.error("Render failed");let{html:t}=await a.json(),s=new Blob([t],{type:"text/html"}),l=URL.createObjectURL(s);window.open(l,"_blank")}async function n(a){if(!(await fetch("/api/export",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaign:e})})).ok)return y.A.error("Failed to stage export");window.open("/api/export/".concat(a),"_blank")}return(0,l.useEffect)(()=>{let e=localStorage.getItem("campaign");if(e)try{a(JSON.parse(e))}catch(e){}else a(i())},[a]),(0,l.useEffect)(()=>{localStorage.setItem("campaign",JSON.stringify(t))},[t]),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-[320px_1fr_380px]",children:[(0,s.jsx)("div",{className:"rounded border bg-white",children:(0,s.jsx)(o,{})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"rounded border bg-white p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"font-semibold",children:"Email Canvas"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"rounded border px-3 py-1",onClick:r,children:"Preview HTML"}),(0,s.jsx)("button",{className:"rounded border px-3 py-1",onClick:()=>n("html"),children:"Export HTML"}),(0,s.jsx)("button",{className:"rounded border px-3 py-1",onClick:()=>n("mjml"),children:"Export MJML"}),(0,s.jsx)("button",{className:"rounded border px-3 py-1",onClick:()=>n("json"),children:"Export JSON"})]})]}),(0,s.jsx)(g,{})]}),(0,s.jsx)("div",{id:"ab",className:"rounded border bg-white p-3",children:(0,s.jsx)(N,{})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"rounded border bg-white p-3",children:(0,s.jsx)(v,{})}),(0,s.jsx)("div",{className:"rounded border bg-white p-3",children:(0,s.jsx)(j,{})}),(0,s.jsx)("div",{className:"rounded border bg-white p-3",children:(0,s.jsx)(f,{})})]})]})}}},function(e){e.O(0,[976,647,977,844,744],function(){return e(e.s=905)}),_N_E=e.O()}]);