"use strict";(()=>{var e={};e.id=100,e.ids=[100],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},34767:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var r={};n.r(r),n.d(r,{DELETE:()=>p,GET:()=>u,POST:()=>l});var o=n(17370),i=n(35317),s=n(2579),a=n(26567),c=n(70936);async function u(e){let t=(0,c.CB)(e)||{};return a.NextResponse.json({config:{...t,client_secret:t.client_secret?"••••••••":""}})}async function l(e){let{client_id:t,client_secret:n,base_url:r,redirect_uri:o}=await e.json();if(!t)return a.NextResponse.json({ok:!1,error:"client_id required"},{status:400});let i=a.NextResponse.json({ok:!0});return i.headers.set("Set-Cookie",(0,c.Xk)({client_id:t,client_secret:n,base_url:r,redirect_uri:o})),i}async function p(){let e=a.NextResponse.json({ok:!0});return e.headers.set("Set-Cookie",(0,c.XI)()),e}let f=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/zoho/settings/route",pathname:"/api/zoho/settings",filename:"route",bundlePath:"app/api/zoho/settings/route"},resolvedPagePath:"/home/runner/work/email-builder/email-builder/apps/web/app/api/zoho/settings/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:_,serverHooks:h}=f,m="/api/zoho/settings/route";function g(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}},70936:(e,t,n)=>{n.d(t,{CB:()=>d,N6:()=>v,XI:()=>h,Xk:()=>_,ZI:()=>y,bf:()=>S,bm:()=>g,fZ:()=>k,kP:()=>R});var r=n(84770),o=n.n(r);let i=process.env.ZOHO_CLIENT_ID||"",s=process.env.ZOHO_CLIENT_SECRET||"",a=process.env.ZOHO_REDIRECT_URI||"",c=process.env.ZOHO_BASE_URL||"https://accounts.zoho.com",u=process.env.ENCRYPTION_SECRET||"dev-secret-unsafe";function l(e){let t=o().randomBytes(16),n=o().createHash("sha256").update(u).digest(),r=o().createCipheriv("aes-256-cbc",n,t),i=Buffer.concat([r.update(JSON.stringify(e),"utf8"),r.final()]).toString("base64");return`${t.toString("base64")}.${i}`}function p(e){let[t,n]=e.split("."),r=Buffer.from(t,"base64"),i=o().createHash("sha256").update(u).digest(),s=o().createDecipheriv("aes-256-cbc",i,r);return JSON.parse(Buffer.concat([s.update(Buffer.from(n,"base64")),s.final()]).toString("utf8"))}let f="zoho_cfg";function d(e){let t=e.cookies.get(f)?.value;if(!t)return null;try{return p(t)}catch{return null}}function _(e){return`${f}=${l(e)}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=31536000`}function h(){return`${f}=; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=0`}let m="zoho_session";function g(e){let t={access_token:e.access_token,refresh_token:e.refresh_token,expires_in:Date.now()+1e3*(e.expires_in||3600)};return`${m}=${l(t)}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=2592000`}function k(){return`${m}=; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=0`}function S(e){let t=e.cookies.get(m)?.value;if(!t)return null;try{return p(t)}catch{return null}}function x(e){let t=e?d(e):null,n=t?.client_id||i,r=t?.client_secret||s,o=t?.redirect_uri||a,u=t?.base_url||c;return n?{client_id:n,client_secret:r,redirect_uri:o,base_url:u}:null}function v(e){let t=x(e);if(!t?.client_id)return null;let n=encodeURIComponent("ZohoCRM.modules.ALL,ZohoCRM.settings.ALL");return`${t.base_url}/oauth/v2/auth?response_type=code&client_id=${t.client_id}&scope=${n}&redirect_uri=${encodeURIComponent(t.redirect_uri)}&access_type=offline&prompt=consent`}async function y(e,t){let n=x(t);if(!n)return{error:"Missing Zoho config"};let r=`${n.base_url}/oauth/v2/token?grant_type=authorization_code&client_id=${n.client_id}&client_secret=${n.client_secret}&redirect_uri=${encodeURIComponent(n.redirect_uri)}&code=${encodeURIComponent(e)}`,o=await fetch(r,{method:"POST"});return await o.json()}async function C(e,t){let n=x(t);if(!n)return{error:"Missing Zoho config"};let r=`${n.base_url}/oauth/v2/token?grant_type=refresh_token&client_id=${n.client_id}&client_secret=${n.client_secret}&refresh_token=${encodeURIComponent(e)}`,o=await fetch(r,{method:"POST"});return await o.json()}async function $(e,t){if(!e)return null;if(e.expires_in&&e.expires_in>Date.now()+6e4)return e.access_token;if(e.refresh_token){let n=await C(e.refresh_token,t);if(n.access_token)return n.access_token}return e.access_token||null}async function R(e,t){let n=x(e);if(!n?.client_id)return"/crm/v3/settings/modules"===t?{modules:[{api_name:"Leads",module_name:"Leads"},{api_name:"Contacts",module_name:"Contacts"}]}:t.startsWith("/crm/v3/settings/fields")?{fields:[{api_name:"First_Name",field_label:"First Name"},{api_name:"Last_Name",field_label:"Last Name"},{api_name:"Company",field_label:"Company"}]}:"/userinfo"===t?{email:"mock@zoho.local"}:{};let r=S(e),o=await $(r,e);if(!o)throw Error("No access token; connect Zoho in Settings");let i=await fetch(`https://www.zohoapis.com${t}`,{headers:{Authorization:`Zoho-oauthtoken ${o}`}});if(!i.ok)throw Error(`Zoho error: ${i.status}`);return await i.json()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[910,145],()=>n(34767));module.exports=r})();