"use strict";(()=>{var e={};e.id=179,e.ids=[179],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},35003:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>_,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>d});var r={};n.r(r),n.d(r,{GET:()=>u});var o=n(17370),a=n(35317),i=n(2579),s=n(26567),c=n(70936);async function u(e){try{let t=await (0,c.kP)(e,"/crm/v3/settings/modules");return s.NextResponse.json({modules:t.modules||[]})}catch(e){return s.NextResponse.json({error:e.message},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/zoho/modules/route",pathname:"/api/zoho/modules",filename:"route",bundlePath:"app/api/zoho/modules/route"},resolvedPagePath:"/home/runner/work/email-builder/email-builder/apps/web/app/api/zoho/modules/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:f}=l,_="/api/zoho/modules/route";function h(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:d})}},70936:(e,t,n)=>{n.d(t,{CB:()=>f,N6:()=>x,XI:()=>h,Xk:()=>_,ZI:()=>$,bf:()=>v,bm:()=>g,fZ:()=>k,kP:()=>b});var r=n(84770),o=n.n(r);let a=process.env.ZOHO_CLIENT_ID||"",i=process.env.ZOHO_CLIENT_SECRET||"",s=process.env.ZOHO_REDIRECT_URI||"",c=process.env.ZOHO_BASE_URL||"https://accounts.zoho.com",u=process.env.ENCRYPTION_SECRET||"dev-secret-unsafe";function l(e){let t=o().randomBytes(16),n=o().createHash("sha256").update(u).digest(),r=o().createCipheriv("aes-256-cbc",n,t),a=Buffer.concat([r.update(JSON.stringify(e),"utf8"),r.final()]).toString("base64");return`${t.toString("base64")}.${a}`}function p(e){let[t,n]=e.split("."),r=Buffer.from(t,"base64"),a=o().createHash("sha256").update(u).digest(),i=o().createDecipheriv("aes-256-cbc",a,r);return JSON.parse(Buffer.concat([i.update(Buffer.from(n,"base64")),i.final()]).toString("utf8"))}let d="zoho_cfg";function f(e){let t=e.cookies.get(d)?.value;if(!t)return null;try{return p(t)}catch{return null}}function _(e){return`${d}=${l(e)}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=31536000`}function h(){return`${d}=; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=0`}let m="zoho_session";function g(e){let t={access_token:e.access_token,refresh_token:e.refresh_token,expires_in:Date.now()+1e3*(e.expires_in||3600)};return`${m}=${l(t)}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=2592000`}function k(){return`${m}=; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=0`}function v(e){let t=e.cookies.get(m)?.value;if(!t)return null;try{return p(t)}catch{return null}}function S(e){let t=e?f(e):null,n=t?.client_id||a,r=t?.client_secret||i,o=t?.redirect_uri||s,u=t?.base_url||c;return n?{client_id:n,client_secret:r,redirect_uri:o,base_url:u}:null}function x(e){let t=S(e);if(!t?.client_id)return null;let n=encodeURIComponent("ZohoCRM.modules.ALL,ZohoCRM.settings.ALL");return`${t.base_url}/oauth/v2/auth?response_type=code&client_id=${t.client_id}&scope=${n}&redirect_uri=${encodeURIComponent(t.redirect_uri)}&access_type=offline&prompt=consent`}async function $(e,t){let n=S(t);if(!n)return{error:"Missing Zoho config"};let r=`${n.base_url}/oauth/v2/token?grant_type=authorization_code&client_id=${n.client_id}&client_secret=${n.client_secret}&redirect_uri=${encodeURIComponent(n.redirect_uri)}&code=${encodeURIComponent(e)}`,o=await fetch(r,{method:"POST"});return await o.json()}async function y(e,t){let n=S(t);if(!n)return{error:"Missing Zoho config"};let r=`${n.base_url}/oauth/v2/token?grant_type=refresh_token&client_id=${n.client_id}&client_secret=${n.client_secret}&refresh_token=${encodeURIComponent(e)}`,o=await fetch(r,{method:"POST"});return await o.json()}async function C(e,t){if(!e)return null;if(e.expires_in&&e.expires_in>Date.now()+6e4)return e.access_token;if(e.refresh_token){let n=await y(e.refresh_token,t);if(n.access_token)return n.access_token}return e.access_token||null}async function b(e,t){let n=S(e);if(!n?.client_id)return"/crm/v3/settings/modules"===t?{modules:[{api_name:"Leads",module_name:"Leads"},{api_name:"Contacts",module_name:"Contacts"}]}:t.startsWith("/crm/v3/settings/fields")?{fields:[{api_name:"First_Name",field_label:"First Name"},{api_name:"Last_Name",field_label:"Last Name"},{api_name:"Company",field_label:"Company"}]}:"/userinfo"===t?{email:"mock@zoho.local"}:{};let r=v(e),o=await C(r,e);if(!o)throw Error("No access token; connect Zoho in Settings");let a=await fetch(`https://www.zohoapis.com${t}`,{headers:{Authorization:`Zoho-oauthtoken ${o}`}});if(!a.ok)throw Error(`Zoho error: ${a.status}`);return await a.json()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[910,145],()=>n(35003));module.exports=r})();