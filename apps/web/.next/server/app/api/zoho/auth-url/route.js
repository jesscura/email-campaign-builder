"use strict";(()=>{var e={};e.id=208,e.ids=[208],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},62688:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>d,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{GET:()=>c});var o=r(17370),a=r(35317),i=r(2579),s=r(26567),u=r(70936);async function c(e){let t=(0,u.N6)(e);return s.NextResponse.json({url:t})}let l=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/zoho/auth-url/route",pathname:"/api/zoho/auth-url",filename:"route",bundlePath:"app/api/zoho/auth-url/route"},resolvedPagePath:"/home/runner/work/email-builder/email-builder/apps/web/app/api/zoho/auth-url/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:f,serverHooks:d}=l,_="/api/zoho/auth-url/route";function h(){return(0,i.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:f})}},70936:(e,t,r)=>{r.d(t,{CB:()=>d,N6:()=>$,XI:()=>h,Xk:()=>_,ZI:()=>x,bf:()=>v,bm:()=>g,fZ:()=>k,kP:()=>b});var n=r(84770),o=r.n(n);let a=process.env.ZOHO_CLIENT_ID||"",i=process.env.ZOHO_CLIENT_SECRET||"",s=process.env.ZOHO_REDIRECT_URI||"",u=process.env.ZOHO_BASE_URL||"https://accounts.zoho.com",c=process.env.ENCRYPTION_SECRET||"dev-secret-unsafe";function l(e){let t=o().randomBytes(16),r=o().createHash("sha256").update(c).digest(),n=o().createCipheriv("aes-256-cbc",r,t),a=Buffer.concat([n.update(JSON.stringify(e),"utf8"),n.final()]).toString("base64");return`${t.toString("base64")}.${a}`}function p(e){let[t,r]=e.split("."),n=Buffer.from(t,"base64"),a=o().createHash("sha256").update(c).digest(),i=o().createDecipheriv("aes-256-cbc",a,n);return JSON.parse(Buffer.concat([i.update(Buffer.from(r,"base64")),i.final()]).toString("utf8"))}let f="zoho_cfg";function d(e){let t=e.cookies.get(f)?.value;if(!t)return null;try{return p(t)}catch{return null}}function _(e){return`${f}=${l(e)}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=31536000`}function h(){return`${f}=; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=0`}let m="zoho_session";function g(e){let t={access_token:e.access_token,refresh_token:e.refresh_token,expires_in:Date.now()+1e3*(e.expires_in||3600)};return`${m}=${l(t)}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=2592000`}function k(){return`${m}=; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=0`}function v(e){let t=e.cookies.get(m)?.value;if(!t)return null;try{return p(t)}catch{return null}}function S(e){let t=e?d(e):null,r=t?.client_id||a,n=t?.client_secret||i,o=t?.redirect_uri||s,c=t?.base_url||u;return r?{client_id:r,client_secret:n,redirect_uri:o,base_url:c}:null}function $(e){let t=S(e);if(!t?.client_id)return null;let r=encodeURIComponent("ZohoCRM.modules.ALL,ZohoCRM.settings.ALL");return`${t.base_url}/oauth/v2/auth?response_type=code&client_id=${t.client_id}&scope=${r}&redirect_uri=${encodeURIComponent(t.redirect_uri)}&access_type=offline&prompt=consent`}async function x(e,t){let r=S(t);if(!r)return{error:"Missing Zoho config"};let n=`${r.base_url}/oauth/v2/token?grant_type=authorization_code&client_id=${r.client_id}&client_secret=${r.client_secret}&redirect_uri=${encodeURIComponent(r.redirect_uri)}&code=${encodeURIComponent(e)}`,o=await fetch(n,{method:"POST"});return await o.json()}async function y(e,t){let r=S(t);if(!r)return{error:"Missing Zoho config"};let n=`${r.base_url}/oauth/v2/token?grant_type=refresh_token&client_id=${r.client_id}&client_secret=${r.client_secret}&refresh_token=${encodeURIComponent(e)}`,o=await fetch(n,{method:"POST"});return await o.json()}async function C(e,t){if(!e)return null;if(e.expires_in&&e.expires_in>Date.now()+6e4)return e.access_token;if(e.refresh_token){let r=await y(e.refresh_token,t);if(r.access_token)return r.access_token}return e.access_token||null}async function b(e,t){let r=S(e);if(!r?.client_id)return"/crm/v3/settings/modules"===t?{modules:[{api_name:"Leads",module_name:"Leads"},{api_name:"Contacts",module_name:"Contacts"}]}:t.startsWith("/crm/v3/settings/fields")?{fields:[{api_name:"First_Name",field_label:"First Name"},{api_name:"Last_Name",field_label:"Last Name"},{api_name:"Company",field_label:"Company"}]}:"/userinfo"===t?{email:"mock@zoho.local"}:{};let n=v(e),o=await C(n,e);if(!o)throw Error("No access token; connect Zoho in Settings");let a=await fetch(`https://www.zohoapis.com${t}`,{headers:{Authorization:`Zoho-oauthtoken ${o}`}});if(!a.ok)throw Error(`Zoho error: ${a.status}`);return await a.json()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[910,145],()=>r(62688));module.exports=n})();